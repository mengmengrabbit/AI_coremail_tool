# 邮件智能管理系统

## 项目简介

邮件智能管理系统是一个基于Python和Flask的Web应用，用于智能化管理和分类本地邮件文件夹中的邮件。系统能够自动识别特定类型的邮件，并按照不同的业务类别进行分类展示，提高邮件处理效率。

## 项目结构

```
├── .env                # 环境配置文件
├── README.md           # 项目说明文档
├── main.py             # 应用入口文件
├── requirements.txt    # 项目依赖包列表
├── data/               # 数据目录
│   ├── email_status.db # SQLite数据库文件
│   └── 收件箱/         # 邮件文件夹
├── docs/               # 文档目录
├── src/                # 源代码目录
│   ├── core/           # 核心功能模块
│   │   └── email_manager.py # 邮件管理核心类
│   ├── utils/          # 工具类和配置
│   │   ├── database.py # 数据库管理
│   │   └── settings.py # 系统配置文件
│   ├── web/            # Web应用相关代码
│   │   └── app.py      # Flask应用主文件
│   └── requirements.txt # 依赖包列表
├── static/             # 静态资源文件
│   ├── certificates/   # 专利证书文件存储
│   ├── invoices/       # 专利发票文件存储
│   ├── css/            # CSS样式文件
│   └── js/             # JavaScript文件
├── templates/          # HTML模板文件
│   └── index.html      # 主页面模板
└── tests/              # 测试代码
    ├── test_emails.py  # 测试邮件数据
    └── __init__.py
```

## 功能特点

### 核心功能
- **专利审查临期提醒**：自动识别专利审查通知邮件，智能提取申请号、答复期限等关键信息，按紧急程度排序展示
- **专利授权证书汇总**：自动识别并提取专利授权证书邮件，支持附件下载和证书文件管理
- **专利费用发票汇总**：智能识别专利费用发票邮件，分类管理官方票据、代理票据等不同类型文件
- **软件协会通知汇总**：使用AI大模型智能分类软件协会通知，支持评奖评优、活动提醒、服务采购、企业资质等分类

### 智能特性
- **多格式邮件解析**：支持.eml、.msg、.mbox等多种邮件格式
- **智能内容提取**：自动解码邮件头信息，处理HTML和纯文本内容，支持quoted-printable编码
- **AI智能分类**：集成InternLM大模型，对软件协会通知进行智能分类
- **附件管理**：自动提取、分类和保存邮件附件，支持在线预览和下载
- **缓存机制**：实现分类结果缓存，提高系统响应速度

### 用户体验
- **紧急程度可视化**：根据答复期限自动计算紧急程度，通过颜色编码直观展示
- **统计数据展示**：实时展示各类邮件的数量统计信息和紧急程度分布
- **响应式界面**：现代化Web界面，支持多设备访问
- **实时更新**：支持手动刷新和自动数据更新

## 环境安装与配置

### 系统要求

- Python 3.6+
- 依赖包：Flask, chardet, requests, python-dateutil, pathlib2, openai, python-dotenv

### 安装步骤

1. 克隆或下载本项目到本地

2. 安装依赖包：

   ```bash
   # 使用项目根目录下的依赖文件安装
   pip install -r requirements.txt
   ```

3. 配置环境变量（必填）

   编辑项目根目录下的`.env`文件，添加必要的配置：

   ```env
   # InternLM大模型API密钥（用于软件协会通知智能分类）
   InternLM=your_internlm_api_key_here
   
   ```

4. 配置邮件文件夹路径（必填）

   **重要**：邮件文件夹路径现在是必填配置项，需要在`src/utils/settings.py`中正确配置：

   ```python
   # 邮件文件夹设置（必填）
   EMAIL_FOLDER_PATH = "./data/收件箱"
   ```

   请将路径修改为您实际的邮件文件夹位置，该文件夹应包含从邮箱客户端导出的.eml邮件文件。

5. 配置邮箱服务器设置（部分选填）

   系统配置文件位于`src/utils/settings.py`，包含以下配置项：
   
   ```python
   # 数据库设置（必填）
   DATABASE_PATH = "./data/email_status.db"
   
   
   # 邮箱账户设置（选填）
   EMAIL_USERNAME = "your_email@domain.com"
   EMAIL_PASSWORD = "your_password"
   
   # IMAP/SMTP服务器设置（选填）
   IMAP_SERVER = "mail.domain.com"
   IMAP_PORT = 993
   SMTP_SERVER = "mail.domain.com"
   SMTP_PORT = 465
   
   # 代理服务器设置（选填）
   PROXY_ENABLED = True
   PROXY_HOST = "proxy.domain.com"
   PROXY_PORT = 8080
   ```
   
   **重要配置说明**：
   - `DATABASE_PATH`：数据库文件路径（必填），用于存储邮件处理状态和缓存数据
   - `EMAIL_FOLDER_PATH`：本地邮件文件夹路径（必填），系统将从此路径读取.eml邮件文件
   - 请根据实际环境修改这些配置，避免在生产环境中使用明文密码
   - 所有路径配置必须使用绝对路径，系统会自动创建所需的目录结构

## 启动与使用

### 启动应用

有两种方式启动应用：

**方式一：使用主启动文件（使用推荐）**
```bash
# 在项目根目录下执行
python main.py
```

**方式二：直接启动Flask应用（调试推荐）**
```bash
# 在项目根目录下执行
python src/web/app.py
```

系统会自动执行以下操作：
1. 检查依赖是否已安装，如未安装则自动安装
2. 初始化邮件管理器和数据库
3. 启动Flask Web服务器（默认端口5000）
4. 自动在浏览器中打开管理界面（http://localhost:5000）

### 使用测试数据

如果无法访问真实的邮件文件夹，系统会自动切换到测试数据模式，使用`tests/test_emails.py`中的模拟数据进行展示。测试模式下，系统会显示多条模拟的专利审查临期提醒邮件，分别具有不同的紧急程度和分类。

测试数据包括：
- 专利审查临期提醒邮件（3条）
- 软件协会通知邮件（多条不同分类）
- 专利授权证书邮件
- 专利费用发票邮件

### 功能使用说明

1. **专利审查临期提醒**：系统会自动扫描邮件文件夹，识别来自专利代理机构的审查通知邮件
2. **专利证书管理**：自动提取专利授权证书附件，支持在线预览和下载
3. **发票管理**：智能分类专利费用发票，区分官方票据和代理票据
4. **软件协会通知**：使用AI大模型自动分类通知类型，支持手动刷新

### 停止应用

在命令行窗口中按下`Ctrl+C`组合键可以停止应用。

## 开发状态

### 已完成功能
- [x] 专利审查临期提醒功能
- [x] 专利授权证书汇总功能
- [x] 专利费用发票汇总功能
- [x] 软件协会通知汇总功能（集成AI智能分类）
- [x] 邮件附件管理和下载功能
- [x] 数据库存储和缓存机制
- [x] 响应式Web界面
- [x] 测试数据模拟功能

### 待开发功能
- [ ] 邮件内容全文搜索功能
- [ ] 邮件规则自定义配置
- [ ] 移动端适配优化
- [ ] **（前期尝试失败，未准确获取邮件传输协议，非IMAP/SMTP）自动连接邮箱客户端并同步邮件，不需要每次人工一键导出**

## 注意事项

### 系统要求
- 系统目前仅支持本地邮件文件夹的处理，不支持直接连接邮箱服务器
- 支持的邮件格式包括.eml、.msg和.mbox
- 首次运行时可能需要一些时间来扫描和解析邮件文件
- 如遇到Python环境问题，请确保使用的是Python 3.6+版本，并且正确安装了所有依赖包

### AI功能说明
- 软件协会通知的智能分类功能需要配置InternLM API密钥
- 如未配置API密钥，软件协会通知将显示为"未分类"
- AI分类结果会自动缓存，避免重复调用API

### 安全建议
- 请勿在代码中硬编码敏感信息（如API密钥、邮箱密码等）
- 生产环境中建议使用环境变量或配置文件管理敏感信息
- 定期备份数据库文件`data/email_status.db`

### 性能优化
- 大量邮件处理时建议分批进行，避免内存占用过高
- 系统会自动创建索引和缓存，提高后续访问速度
- 可根据实际需求调整邮件扫描的文件夹范围
